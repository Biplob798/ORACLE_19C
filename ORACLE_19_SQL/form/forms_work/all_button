
--ALL TRIGGERS FOR EMPLOYEES FORM

--for ADD_EMPLOYEE button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
BEGIN
    -- Make sure the canvas is visible
    SET_CANVAS_PROPERTY('SCANVAS', VISIBLE, PROPERTY_TRUE);

    -- Display the canvas in a window
    SHOW_VIEW('SCANVAS');

    -- Optionally, move focus to first item in the canvas
    GO_ITEM('EMPLOYEES_ADD.FIRST_NAME');

END;


--for QUERY_BUTTON on EMPLOYEES form
--WHEN-BUTTON-PRESSED
begin
	go_block('EMPLOYEES');
	execute_query;
	end;

--for NEXT_RECORD button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
begin
	go_block('EMPLOYEES');
	next_record;
end;
 --for PREVIOUS_RECORD button on EMPLOYEES form 
--WHEN-BUTTON-PRESSED
begin
	go_block('EMPLOYEES');
	previous_record;
end;
--for EXIT button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
BEGIN
    -- Go directly to Home Page form
    NEW_FORM('HOMEPAGE');
END;


--for DELETE_RECORD button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
begin
	if show_alert('DELETE')=alert_button1 then
	GO_BLOCK('EMPLOYEES');
	delete_record;
	commit_form;
end if;
end;


--for search field on EMPLOYEES form
--WHEN-NEW-FORM-INSTANCE
BEGIN
SET_BLOCK_PROPERTY
('EMPLOYEES', ONETIME_WHERE,'EMPLOYEE_ID='||':CONTROL.SEARCH_EMPLOYEE_ID');
GO_BLOCK('EMPLOYEES');
EXECUTE_QUERY;
END;

--for SEARCH button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
BEGIN
SET_BLOCK_PROPERTY
('EMPLOYEES', ONETIME_WHERE,'EMPLOYEE_ID='||':CONTROL.SEARCH_EMPLOYEE_ID');
GO_BLOCK('EMPLOYEES');
EXECUTE_QUERY;
END;

 
 --for ADD_EMPLOYEE button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
BEGIN
    -- Make sure the canvas is visible
    SET_CANVAS_PROPERTY('SCANVAS', VISIBLE, PROPERTY_TRUE);

    -- Display the canvas in a window
    SHOW_VIEW('SCANVAS');

    -- Optionally, move focus to first item in the canvas
    GO_ITEM('EMPLOYEES_ADD.FIRST_NAME');

END;



--for EDIT_EMPLOYEE button on EMPLOYEES form
--WHEN-BUTTON-PRESSED
DECLARE
    v_emp_id EMPLOYEES.EMPLOYEE_ID%TYPE;
BEGIN
    v_emp_id := :EMPLOYEES.EMPLOYEE_ID;

    IF v_emp_id IS NOT NULL THEN

       -- show stacked canvas
       SHOW_VIEW('SCANVAS');

       -- go to edit block (??? block ?? ??? EMPLOYEES_ADD_BLOCK)
       GO_BLOCK('EMPLOYEES_ADD');

       -- fetch only selected employee
       SET_BLOCK_PROPERTY('EMPLOYEES_ADD', DEFAULT_WHERE,
                          'EMPLOYEE_ID = ' || v_emp_id);
       EXECUTE_QUERY;

    ELSE
       MESSAGE('Please select an employee.');
       MESSAGE(' ', NO_ACKNOWLEDGE);
    END IF;
END;




--for SAVE button on EMPLOYEES_ADD form
--WHEN-BUTTON-PRESSED


BEGIN
    -- 1?? Save current changes
    COMMIT;

    -- 2?? Clear EMPLOYEES block safely

        GO_BLOCK('EMPLOYEES');
        CLEAR_BLOCK(NO_VALIDATE);


    -- 3?? Clear DEPARTMENTS block safely    GO_BLOCK('DEPARTMENTS');
        CLEAR_BLOCK(NO_VALIDATE);


    -- 4?? Hide popup canvas if used
    SET_CANVAS_PROPERTY('SCANVAS', VISIBLE, PROPERTY_FALSE);
      -- Set ORDER BY to show last record at top
    SET_BLOCK_PROPERTY('EMP_DEPT_VIEW', ORDER_BY, 'EMPLOYEE_ID DESC');

    -- 5?? Go to EMP_DEPT_VIEW block
    GO_BLOCK('EMP_DEPT_VIEW');
    -- 6?? Execute query to refresh data
    EXECUTE_QUERY;
    
    -- 7?? Move to top record
    FIRST_RECORD;
END;


--for UPDATE button on ADD_WAREHOUSE_LIST form
--WHEN-BUTTON-PRESSED

BEGIN
    UPDATE warehouse_list
       SET warehouse_code = :ADD_WAREHOUSE_LIST.warehouse_code,
           warehouse_name = :ADD_WAREHOUSE_LIST.warehouse_name,
           location       = :ADD_WAREHOUSE_LIST.location,
           city           = :ADD_WAREHOUSE_LIST.city,
           capacity       = :ADD_WAREHOUSE_LIST.capacity,
           status         = :ADD_WAREHOUSE_LIST.status
     WHERE warehouse_id   = :ADD_WAREHOUSE_LIST.warehouse_id;

    COMMIT;

    MESSAGE('? Warehouse list updated successfully.');
    MESSAGE(' ', NO_ACKNOWLEDGE);

    -- Optional: Hide stacked canvas after update
    HIDE_VIEW('ADD_WAREHOUSE_LIST');

    -- Optional: Refresh main block
    GO_BLOCK('WAREHOUSE_LIST');
    EXECUTE_QUERY;
END; 

 --for back button on EMPLOYEES_ADD form
--WHEN-BUTTON-PRESSED
BEGIN
    -- Hide the popup canvas
    HIDE_VIEW('SCANVAS');
    SET_CANVAS_PROPERTY('SCANVAS', VISIBLE, PROPERTY_FALSE);

    -- Return focus to main content block
    GO_BLOCK('EMPLOYEES');
END;