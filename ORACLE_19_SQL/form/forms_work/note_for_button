refresh button code
--WHEN-BUTTON-PRESSED
BEGIN
    -- 1. Explicitly move to the main data block
    GO_BLOCK('DEPARTMENTS');

    -- 2. Set the ORDER BY property to sort by DEPARTMENT_ID in ascending order.
    SET_BLOCK_PROPERTY('DEPARTMENTS', ORDER_BY, 'DEPARTMENT_ID ASC');

    -- 3. Execute the query to fetch and display the data with the new sort order
    EXECUTE_QUERY;

    -- Optional: Display a confirmation message
    MESSAGE('Departments refreshed and sorted by ID.');
    MESSAGE(' ', NO_ACKNOWLEDGE);
END;


for next_record button
--WHEN-BUTTON-PRESSED

BEGIN
	GO_BLOCK('DEPARTMENTS');
NEXT_RECORD;
END;


for previous_record button
--WHEN-BUTTON-PRESSED   
BEGIN
    GO_BLOCK('DEPARTMENTS');    
    PREVIOUS_RECORD;
END;

for exit button
--WHEN-BUTTON-PRESSED
BEGIN
    -- Go directly to Home Page form
    NEW_FORM('HOMEPAGE');
END;
for delete_record button
--WHEN-BUTTON-PRESSED       
BEGIN
    IF SHOW_ALERT('DELETE') = ALERT_BUTTON1 THEN
        GO_BLOCK('DEPARTMENTS');
        DELETE_RECORD;
        COMMIT_FORM;
    END IF;
END;



for insert button
--WHEN-BUTTON-PRESSED
BEGIN
    -- Make the stacked canvas visible
    SET_CANVAS_PROPERTY('SCANVAS', VISIBLE, PROPERTY_TRUE);

    -- Display the canvas on top of the main window
    SHOW_VIEW('SCANVAS');

    -- Move focus to the first item in the popup block
    GO_ITEM('ADD_DEPARTMENTS.DEPARTMENT_NAME');

    -- Optional: clear previous values
    CLEAR_BLOCK(NO_VALIDATE);
END;

FOR SEARCH  FIELD
--WHEN-LIST-CHANGED

DECLARE
V_SEARCH VARCHAR2(100);
V_CURRENT_ITEM VARCHAR2(30);
BEGIN
-- STORE CURRENT ITEM
V_CURRENT_ITEM := :SYSTEM.CURSOR_ITEM;

--PREPARE SEARCH STRING
V_SEARCH := UPPER(TRIM(:CONTROL.SEARCH));

GO_BLOCK('DEPARTMENTS');

SET_BLOCK_PROPERTY('DEPARTMENTS',DEFAULT_WHERE,
'UPPER(NVL(DEPARTMENT_ID, '''')) LIKE ''%' || V_SEARCH || '%'' '||
'OR TO_CHAR(DEPARTMENT_NAME) LIKE ''%' || V_SEARCH ||'%'' ');

EXECUTE_QUERY(NO_VALIDATE);

GO_ITEM(V_CURRENT_ITEM );
END;


for save button on popup
--WHEN-BUTTON-PRESSED
commit;




CREATE OR REPLACE TRIGGER SCMDB.TR_VW_PURCHASE_INFO2_IU
INSTEAD OF UPDATE ON SCMDB.VW_PURCHASE_INFO2
FOR EACH ROW
BEGIN
    -- 1. Update the Header Table (PURCHASE_MASTER)
    -- Includes your new NET_TOTAL_AMOUNT update, plus all master payment/quote fields.
    UPDATE SCMDB.PURCHASE_MASTER PM
    SET 
        PM.GIVEN_AMOUNT = :NEW.MASTER_GIVEN_AMOUNT,
        PM.DUE_AMOUNT = :NEW.MASTER_DUE_AMOUNT,      
        PM.QUOT_MASTER_ID = :NEW.QUOT_MASTER_ID,
        PM.MODIFIED_DATE = SYSDATE,
        -- **Omitted Supplier Name Update in PM:** -- Based on your schema, if the Forms application sends MASTER_SUPPLIER_NAME
        -- and you don't update it here, you might still get ORA-01779 if that's the non key-preserved column.
        -- If you want to include it, use: PM.SUPPLIER_NAME = :NEW.DETAIL_SUPPLIER_NAME, 
        NULL = NULL  -- Placeholder to maintain structure
    WHERE PM.PURCHASE_ID = :OLD.MASTER_PURCHASE_ID;
    
    
    -- 2. Update the Detail Table (PURCHASE_DETAILS)
    -- Includes Quantity (QUTE_QUANTITY) and Price (QUATATION_PRICE) for completeness,
    -- as they are part of the detailed data and were in the original Forms update statement.
    UPDATE SCMDB.PURCHASE_DETAILS PD
    SET 
        PD.GIVEN_AMOUNT = :NEW.DETAIL_GIVEN_AMOUNT,
        PD.DUE_AMOUNT = :NEW.DETAIL_DUE_AMOUNT,      
        -- Re-added the detail line fields that are often included in the Forms UPDATE statement:
    WHERE PD.PURCHASE_DETAIL_ID = :OLD.PURCHASE_DETAIL_ID;
    
    
    UPDATE SCMDB.PURCHASE_DETAILS PD
    SET PD.SUPPLIER_NAME = :NEW.DETAIL_SUPPLIER_NAME
    WHERE PD.PURCHASE_DETAIL_ID = :OLD.PURCHASE_DETAIL_ID;
    
    -- **If the supplier name is meant to be updated in PURCHASE_MASTER, uncomment this and comment out the above:**
    /*
    UPDATE SCMDB.PURCHASE_MASTER PM
    SET PM.SUPPLIER_NAME = :NEW.DETAIL_SUPPLIER_NAME
    WHERE PM.PURCHASE_ID = :OLD.MASTER_PURCHASE_ID;
    */
    
END;
/