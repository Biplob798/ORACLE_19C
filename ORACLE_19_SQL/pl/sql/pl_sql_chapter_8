 --cursor declare step by step

-- step_1
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
end;
/
-- step_2
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
open c_emp;
end;
/
-- step_3
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
open c_emp;
fetch c_emp;
end;
/
-- step_4
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
open c_emp;
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
end;
/
-- step_5
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
open c_emp;
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
end;
/

-- step_6
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
open c_emp;
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end;
/
-- step_7
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
open c_emp;
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/
-- step_8
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
open c_emp;
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/
-- step_9
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
open c_emp;
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
close c_emp;
end;
/


-- use for loop in cursor 

-- step_1

declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
open c_emp;
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
close c_emp;
end;
/

-- step_2
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
open c_emp;
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/

-- step_3
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/
-- step_4
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
loop
fetch c_emp into
v_emp_id,
v_first_name,
v_last_name;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/
-- step_5
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
loop
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/
-- step_6
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
for v_emp_rec in c_emp 
loop
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
end;
/
-- step_7
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
for v_emp_rec in c_emp 
loop
dbms_output.put_line(v_emp_rec.employee_id||' '||v_emp_rec.first_name||' '||v_emp_rec.last_name);
end loop;
end;
/
-- use subquery in cursor for loop 
-- step_1
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
begin
for v_emp_rec in c_emp 
loop
dbms_output.put_line(v_emp_rec.employee_id||' '||v_emp_rec.first_name||' '||v_emp_rec.last_name);
end loop;
end;
/

-- step_2
declare
begin
for v_emp_rec in (select employee_id,first_name,last_name 
from employees
where department_id=30)
loop
dbms_output.put_line(v_emp_rec.employee_id||' '||v_emp_rec.first_name||' '||v_emp_rec.last_name);
end loop;
end;
/

-- user record in cursor 

-- step_1
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_rec c_emp%rowtype;
begin
open c_emp;
loop
fetch c_emp into 
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
close c_emp;
end;
/

-- step_2
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_rec c_emp%rowtype;
begin
open c_emp;
loop
fetch c_emp into 
v_emp_rec;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
close c_emp;
end;
/
-- step_3
declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_rec c_emp%rowtype;
begin
open c_emp;
loop
fetch c_emp into 
v_emp_rec;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_rec.employee_id||' '||v_emp_rec.first_name||' '||v_emp_rec.last_name);
end loop;
close c_emp;
end;
/


-- cursor attributes
-- 1.%isopen
-- 2.%found
-- 3.%notfound
-- 4.%rowcount   




declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_rec c_emp%rowtype;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
if c_emp%isopen then
dbms_output.put_line('cursor is open');
end if;
open c_emp;
loop
fetch c_emp into 
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line(v_emp_id||' '||v_first_name||' '||v_last_name);
end loop;
close c_emp;
end;
/


declare
cursor c_emp is 
select employee_id,first_name,last_name 
from employees
where department_id=30;
v_emp_rec c_emp%rowtype;
v_emp_id employees.employee_id%type;
v_first_name employees.first_name%type; 
v_last_name employees.last_name%type;
begin
if not c_emp%isopen then
dbms_output.put_line('cursor is open');
open c_emp;
end if;
loop
fetch c_emp into 
v_emp_id,
v_first_name,
v_last_name;
exit when c_emp%notfound;
dbms_output.put_line('The Row number is :' ||c_emp%rowcount || '-'|| v_emp_id||' '||v_first_name||' '||v_last_name );
end loop;
close c_emp;
end;
/


-- without cursor declare in for loop 



begin
for emp_record in (select employee_id,first_name,last_name 
from employees  
where department_id=30)
loop
dbms_output.put_line(emp_record.employee_id||' '||emp_record.first_name||' '||emp_record.last_name );
end loop;
end;
/



-- user parameter in cursor 

declare
cursor c_emp_cursor is
select employee_id,last_name,department_id
from employees
where department_id=30;
cursor c_emp_cursor1 is
select employee_id,last_name,department_id
from employees
where department_id=40;
cursor c_emp_cursor2 is
select employee_id,last_name,department_id
from employees
where department_id=50;
begin
for emp_record in c_emp_cursor
loop
dbms_output.put_line(emp_record.employee_id||' '||emp_record.last_name||' '||emp_record.department_id );
end loop;
for emp_record in c_emp_cursor1
loop    
dbms_output.put_line(emp_record.employee_id||' '||emp_record.last_name||' '||emp_record.department_id );
end loop;
for emp_record in c_emp_cursor2
loop
dbms_output.put_line(emp_record.employee_id||' '||emp_record.last_name||' '||emp_record.department_id );
end loop;
end;
/


-- lock row by for update clause in cursor and use where current of clause in update statement

-- step_1
create table emp_lock as select employee_id,job_id,salary from employees where employee_id<110;
select * from emp_lock;

-- step_2

declare
cursor c1 is
select employee_id,job_id,salary
from emp_lock for update;
emp_record c1%rowtype;
begin
open c1;
loop
fetch c1 into emp_record;  --PROTHOME BAR FETCH KORCHE BUT SECOND FAILED FOR UPDATE CLUASE.
if emp_record.job_id='IT_PROG' then
update emp_lock 
set salary=emp_record.salary+1000;
end if;
exit when c1%notfound;
end loop;
end;    
/

-- step_3_user where clause in update statement

declare
cursor c1 is
select employee_id,job_id,salary
from emp_lock for update;
emp_record c1%rowtype;
begin
open c1;
loop
fetch c1 into emp_record; 
if emp_record.job_id='IT_PROG' then
update emp_lock 
set salary=emp_record.salary+1000
where employee_id=emp_record.employee_id;
end if;
exit when c1%notfound;
end loop;
end;    
/
 
-- step_3_user where current of clause in update statement

declare
cursor c1 is
select employee_id,job_id,salary
from emp_lock for update;
emp_record c1%rowtype;
begin
open c1;
loop
fetch c1 into emp_record; 
if emp_record.job_id='IT_PROG' then
update emp_lock 
set salary=emp_record.salary+1000
where current of c1;
end if;
exit when c1%notfound;
end loop;
end;    
/
 
-- activity book practice

declare
v_depatno number :=10;
cursor c_emp_cursor is
select last_name,salary,manager_id from employees where department_id=v_depatno;
begin
for emp_record in c_emp_cursor
loop
if 
emp_record.salary>5000 
and 
emp_record.manager_id 
in(101,124) 
then
dbms_output.put_line(emp_record.last_name||'Due for a raise');
else
dbms_output.put_line(emp_record.last_name||'Not Due for a raise');
end if;
end loop;
end;
/


declare
v_depatno number :=&deptnum;
cursor c_emp_cursor is
select last_name,salary,manager_id from employees where department_id=v_depatno;
begin
for emp_record in c_emp_cursor
loop
if 
emp_record.salary>5000 
and 
emp_record.manager_id 
in(101,124) 
then
dbms_output.put_line(emp_record.last_name||'Due for a raise');
else
dbms_output.put_line(emp_record.last_name||'Not Due for a raise');
end if;
end loop;
end;
/



declare
v_dept_id departments.department_id%TYPE;
v_dept_name departments.department_name%TYPE;
cursor c_dept_cursor is
select department_id,department_name from departments
where department_id<100;
begin
open c_dept_cursor;
loop
fetch c_dept_cursor into
v_dept_id,v_dept_name;
exit when c_dept_cursor%notfound;
dbms_output.put_line(v_dept_id||' '||v_dept_name);
end loop;
close c_dept_cursor;
end;
/

declare
v_deptno number :=30;
v_emp_id employees.employee_id%TYPE;
v_last_name employees.last_name%TYPE;
v_job_id employees.job_id%TYPE;
v_hire_date employees.hire_date%TYPE;
v_salary employees.salary%TYPE;
cursor c_emp_cursor(v_deptno  number) is
select employee_id,last_name,job_id,hire_date,salary from employees
where department_id =v_deptno 
and
employee_id<120;
begin
open c_emp_cursor(v_deptno);
loop
fetch c_emp_cursor into v_emp_id,v_last_name,v_job_id,v_hire_date,v_salary;
exit when c_emp_cursor%notfound;
dbms_output.put_line(v_emp_id||' '||v_last_name||' '||v_job_id||' '||v_hire_date||' '||v_salary);
end loop;
close c_emp_cursor;
end;    
/



