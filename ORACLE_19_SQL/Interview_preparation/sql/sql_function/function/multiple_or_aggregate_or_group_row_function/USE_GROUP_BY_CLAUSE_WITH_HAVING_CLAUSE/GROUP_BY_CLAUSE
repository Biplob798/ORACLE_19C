SELECT   department_id, AVG(salary)
FROM     employees
GROUP BY department_id ;


SELECT   AVG(salary)
FROM   
  employees
GROUP BY department_id ;

SELECT   AVG(salary)
FROM   
  employees
GROUP BY department_id ;

-- The GROUP BY column does not have to be in the SELECT list.

SELECT   department_id, AVG(salary)
FROM     employees
GROUP BY department_id
ORDER BY AVG(salary);

SELECT   department_id, AVG(salary)
FROM     employees
GROUP BY department_id
ORDER BY AVG(salary);


SELECT   department_id, job_id, sum(salary)
FROM     employees
GROUP BY department_id, job_id
ORDER BY job_id;



-- Using the GROUP BY Clause on Multiple Columns


SELECT   department_id, job_id, sum(salary)
FROM     employees
GROUP BY department_id, job_id
ORDER BY job_id;


SELECT   department_id, job_id, SUM(salary)
FROM     employees
WHERE
department_id > 40
GROUP BY department_id, job_id 
ORDER BY department_id;



-- Any column or expression in the SELECT list that is not an 
-- aggregate function must be in the GROUP BY clause:


SELECT department_id, COUNT(last_name)
FROM   
employees;


SELECT department_id, job_id, COUNT(last_name)
FROM   employees
GROUP BY department_id;



SELECT department_id, job_id, COUNT(last_name)
FROM   employees
GROUP BY department_id, job_id;



-- Illegal Queries Using Group Functions


-- • You cannot use the WHERE clause to restrict groups.
-- • You use the HAVING clause to restrict groups.
-- • You cannot use group functions in the WHERE clause.



SELECT   department_id, AVG(salary)
FROM     employees
WHERE    AVG(salary) > 8000
GROUP BY department_id;

-- The WHERE clause cannot be used to restrict groups. The SELECT statement in the example 
-- in the slide results in an error because it uses the WHERE clause to restrict the display of the 
-- average salaries of those departments that have an average salary greater than $8,000.
-- However, you can correct the error in the example by using the HAVING clause to restrict 
-- groups:


SELECT   department_id, AVG(salary)
FROM     employees
GROUP BY department_id
HAVING   AVG(salary) > 8000;