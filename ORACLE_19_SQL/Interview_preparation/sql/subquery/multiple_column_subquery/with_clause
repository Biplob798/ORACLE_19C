
-- The WITH clause (also known as a CTE) allows you to define a subquery block at the very beginning of your statement. This makes complex queries much easier to read and allows you to reuse the "virtual table" multiple times.

-- Example: Define a "High Earners" table first, then select from it.



WITH high_earners AS (
    SELECT * FROM employees WHERE salary > 10000
)
SELECT last_name, salary 
FROM high_earners 
WHERE department_id = 90;




WITH CNT_DEPT AS
(
SELECT department_id,
COUNT(1) NUM_EMP
FROM EMPLOYEES
GROUP BY department id GROUP BY department_id
)
SELECT employee_id,
SALARY/NUM_EMP
FROM EMPLOYEES E
JOIN CNT_DEPT C
ON (e.department_id = c.department_id);