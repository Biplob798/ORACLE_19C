CREATE TABLE USER_INFO (
    USER_ID     NUMBER         PRIMARY KEY,
    USERNAME    VARCHAR2(100)  NOT NULL,
    PASSWORD    VARCHAR2(100)  NOT NULL,
    FULL_NAME   VARCHAR2(200),
    EMAIL       VARCHAR2(100),
    USER_IMAGE BLOB,
    ROLE        VARCHAR2(50),
    STATUS      VARCHAR2(50) DEFAULT 'ACTIVE',
    CREATED_AT  DATE DEFAULT SYSDATE
);



CREATE TABLE COMPANY (
    COMPANY_ID          NUMBER            NOT NULL,
    COMPANY_CODE        VARCHAR2(20)       NOT NULL,
    COMPANY_NAME        VARCHAR2(200)      NOT NULL,
    COMPANY_SHORT_NAME  VARCHAR2(100),
    TAGLINE             VARCHAR2(255),
    ADDRESS_LINE1       VARCHAR2(200),
    ADDRESS_LINE2       VARCHAR2(200),
    CITY                VARCHAR2(100),
    STATE_NAME          VARCHAR2(100),
    COUNTRY             VARCHAR2(100),
    POSTAL_CODE         VARCHAR2(20),
    PHONE_NUMBER        VARCHAR2(30),
    EMAIL               VARCHAR2(150),
    WEBSITE             VARCHAR2(150),
    LOGO                BLOB,
    STATUS              VARCHAR2(20),

    CREATED_BY          VARCHAR2(50),
    CREATED_DATE        DATE DEFAULT SYSDATE,
    UPDATED_BY          VARCHAR2(50),
    UPDATED_DATE        DATE DEFAULT SYSDATE,

    CONSTRAINT PK_COMPANY PRIMARY KEY (COMPANY_ID)
);
CREATE TABLE DEPARTMENTS (
    DEPARTMENT_ID     NUMBER            NOT NULL,
    DEPARTMENT_NAME   VARCHAR2(100)      NOT NULL,
    DESCRIPTION       VARCHAR2(255),
    ACTION_USER       VARCHAR2(50),
    STATUS            VARCHAR2(20),
    CREATED_DATE      DATE DEFAULT SYSDATE,
    UPDATED_DATE      DATE DEFAULT SYSDATE,
    SALARY            NUMBER(10,2),

    CONSTRAINT PK_DEPARTMENTS PRIMARY KEY (DEPARTMENT_ID)
);
CREATE TABLE DESIGNATION (
    DESIGNATION_ID     NUMBER            NOT NULL,
    DESIGNATION_NAME   VARCHAR2(100),
    DESCRIPTION        VARCHAR2(255),
    ACTION_USER        VARCHAR2(50),
    STATUS             VARCHAR2(20),
    CREATED_DATE       DATE DEFAULT SYSDATE,
    UPDATED_DATE       DATE DEFAULT SYSDATE,

    CONSTRAINT PK_DESIGNATION PRIMARY KEY (DESIGNATION_ID)
);
CREATE TABLE EMPLOYEES (
    EMPLOYEE_ID            NUMBER            NOT NULL,
    FIRST_NAME             VARCHAR2(100)     NOT NULL,
    LAST_NAME              VARCHAR2(100)     NOT NULL,
    FATHER_NAME            VARCHAR2(100),
    MOTHER_NAME            VARCHAR2(100),
    PRESENT_ADDRESS        VARCHAR2(350),
    PERMANENT_ADDRESS      VARCHAR2(350),
    SALARY                 NUMBER(10,2),

    JOIN_DATE              DATE DEFAULT SYSDATE,
    DATE_OF_BIRTH          DATE ,

    NID                    NUMBER,
    EMAIL                  VARCHAR2(100),
    CONTACT_NO             VARCHAR2(100),
    GENDER                 VARCHAR2(100),
    RELIGION               VARCHAR2(100),
    NATIONALITY            VARCHAR2(100),
    BLOOD_GROUP            VARCHAR2(100),

    DESIGNATION_ID         NUMBER            NOT NULL,
    DEPARTMENT_ID          NUMBER            NOT NULL,

    EMPLOYEE_IMAGE         BLOB,
    EMPLOYEE_STATUS        VARCHAR2(100),
    EMPLOYEE_DESCRIPTION   VARCHAR2(300),
    ACTION_USER            VARCHAR2(100),

    ACTION_DATE_TIME       DATE DEFAULT SYSDATE,
    CREATED_DATE           DATE DEFAULT SYSDATE,
    UPDATED_DATE           DATE DEFAULT SYSDATE,

    CONSTRAINT PK_EMPLOYEES PRIMARY KEY (EMPLOYEE_ID)
);
-- Add foreign key to DESIGNATION_ID
ALTER TABLE EMPLOYEES
ADD CONSTRAINT FK_EMP_DESIGNATION
FOREIGN KEY (DESIGNATION_ID)
REFERENCES DESIGNATION (DESIGNATION_ID);

-- Add foreign key to DEPARTMENT_ID
ALTER TABLE EMPLOYEES
ADD CONSTRAINT FK_EMP_DEPARTMENT
FOREIGN KEY (DEPARTMENT_ID)
REFERENCES DEPARTMENTS (DEPARTMENT_ID);



CREATE TABLE PRODUCT_CATEGORY (
    CATEGORY_ID      NUMBER         PRIMARY KEY,
    CATEGORY_NAME    VARCHAR2(100)  NOT NULL,
    DESCRIPTION      VARCHAR2(255),
    ACTION_USER      VARCHAR2(50),
    STATUS           VARCHAR2(20),
    CREATED_DATE     DATE DEFAULT SYSDATE,
    UPDATED_DATE     DATE DEFAULT SYSDATE
);

CREATE TABLE PRODUCT_TYPE (
    TYPE_ID       NUMBER         PRIMARY KEY,
    TYPE_NAME     VARCHAR2(100)  NOT NULL,
    DESCRIPTION   VARCHAR2(255),
    ACTION_USER   VARCHAR2(50),
    STATUS        VARCHAR2(20),
    CREATED_DATE  DATE DEFAULT SYSDATE,
    UPDATED_DATE  DATE DEFAULT SYSDATE
);

CREATE TABLE PRODUCT_BRAND (
    BRAND_ID      NUMBER         PRIMARY KEY,
    BRAND_NAME    VARCHAR2(100)  NOT NULL,
    DESCRIPTION   VARCHAR2(255),
    ACTION_USER   VARCHAR2(50),
    STATUS        VARCHAR2(20),
    CREATED_DATE  DATE DEFAULT SYSDATE,
    UPDATED_DATE  DATE DEFAULT SYSDATE
);

CREATE TABLE PRODUCTS (
    PRODUCT_ID       NUMBER         PRIMARY KEY,
    PRODUCT_NAME     VARCHAR2(150)  NOT NULL,
    PURCHASE_PRICE   NUMBER(10,2),
    SELL_PRICE       NUMBER(10,2),
    UNIT_PRICE       NUMBER(10,2),
    STOCK_QTY        NUMBER,
    BRAND_ID         NUMBER,
    CATEGORY_ID      NUMBER,
    TYPE_ID          NUMBER,
    SKU              VARCHAR2(50),
    PRODUCT_IMAGE    BLOB,
    IS_FEATURED      CHAR(1) DEFAULT 'N',
    REORDER_LEVEL    NUMBER,
    ACTION_USER      VARCHAR2(50),
    STATUS           VARCHAR2(50) DEFAULT 'ACTIVE',
    CREATED_DATE     DATE DEFAULT SYSDATE,
    UPDATED_DATE     DATE DEFAULT SYSDATE,
    DESCRIPTION      VARCHAR2(255)
);

-- Add foreign key for BRAND_ID
ALTER TABLE PRODUCTS
ADD CONSTRAINT FK_PRODUCTS_BRAND
FOREIGN KEY (BRAND_ID)
REFERENCES PRODUCT_BRAND (BRAND_ID);

-- Add foreign key for CATEGORY_ID
ALTER TABLE PRODUCTS
ADD CONSTRAINT FK_PRODUCTS_CATEGORY
FOREIGN KEY (CATEGORY_ID)
REFERENCES PRODUCT_CATEGORY (CATEGORY_ID);

-- Add foreign key for TYPE_ID
ALTER TABLE PRODUCTS
ADD CONSTRAINT FK_PRODUCTS_TYPE
FOREIGN KEY (TYPE_ID)
REFERENCES PRODUCT_TYPE (TYPE_ID);

CREATE TABLE SUPPLIERS (
    SUPPLIER_ID      NUMBER(38)      PRIMARY KEY,
    SUPPLIER_NAME    VARCHAR2(150)   NOT NULL,
    CONTACT_PERSON   VARCHAR2(100),
    CONTACT_NO       VARCHAR2(20),
    EMAIL            VARCHAR2(100),
    CITY             VARCHAR2(50),
    TIN_NUMBER       VARCHAR2(50),
    PAYMENT_TERMS    VARCHAR2(50),
    STATUS           VARCHAR2(50) DEFAULT 'ACTIVE',
    CREATED_DATE     DATE DEFAULT SYSDATE,
    UPDATED_DATE     DATE DEFAULT SYSDATE
);
CREATE TABLE WAREHOUSE_LIST (
    WAREHOUSE_LIST_ID NUMBER(38)    PRIMARY KEY,
    WAREHOUSE_CODE    VARCHAR2(20),
    WAREHOUSE_NAME    VARCHAR2(100) NOT NULL,
    LOCATION          VARCHAR2(100),
    CITY              VARCHAR2(50),
    CAPACITY          NUMBER(38),
    STATUS            VARCHAR2(20) DEFAULT 'ACTIVE',
    REMARKS           VARCHAR2(255),
    CREATED_DATE      DATE DEFAULT SYSDATE,
    UPDATED_DATE      DATE DEFAULT SYSDATE
);

CREATE TABLE CUSTOMER (
    CUSTOMER_ID     NUMBER         PRIMARY KEY,
    CUSTOMER_NAME   VARCHAR2(100)  NOT NULL,
    GENDER          VARCHAR2(10),
    PHONE_NUMBER    VARCHAR2(20),
    EMAIL           VARCHAR2(100),
    ADDRESS         VARCHAR2(200),
    CREATED_BY      VARCHAR2(50),
    CREATED_DATE    DATE DEFAULT SYSDATE,
    UPDATED_BY      VARCHAR2(50),
    UPDATED_DATE    DATE DEFAULT SYSDATE
);

CREATE TABLE req_master (
    requisition_id   NUMBER        NOT NULL,
    requisition_date DATE          DEFAULT SYSDATE,
    create_date      DATE          DEFAULT SYSDATE,
    total_amount     NUMBER,
    remarks          VARCHAR2(200),
    create_by        VARCHAR2(100),
    quot_status      NUMBER        DEFAULT 0
);



CREATE TABLE REQ_DETAILS (
    REQ_DETAIL_ID   NUMBER        NOT NULL,
    REQUISITION_ID  NUMBER,
    QTY_REQUESTED   NUMBER,
    REMARKS         VARCHAR2(100),
    PRODUCT_ID      NUMBER,
    PRODUCT_NAME    VARCHAR2(100),
    PURCHASE_PRICE  NUMBER,
    SELL_PRICE      NUMBER,
    CREATE_DATE     DATE          DEFAULT SYSDATE,
    CREATE_BY       VARCHAR2(100)
);

ALTER TABLE REQ_DETAILS
ADD CONSTRAINT FK_PRODUCT
FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCTS (PRODUCT_ID);

ALTER TABLE REQ_DETAILS
ADD CONSTRAINT FK_REQ_MASTER
FOREIGN KEY (REQUISITION_ID)
REFERENCES REQ_MASTER (REQUISITION_ID);


CREATE TABLE QUOTATION_MASTER (
    QUOT_MASTER_ID NUMBER        NOT NULL,
    REQ_ID         NUMBER,
    QUOT_DATE      DATE          DEFAULT SYSDATE,
    CREATE_BY      VARCHAR2(50),
    CREATE_DATE    DATE          DEFAULT SYSDATE,
    UPDATE_BY      VARCHAR2(50),
    UPDATE_DATE    DATE,
    APPROVED       NUMBER        DEFAULT 0,
    APPROVED_DATE  DATE
);


CREATE TABLE QUOTATION_DETAILS (
    QUOT_DET_ID       NUMBER        NOT NULL,
    QUOT_MASTER_ID    NUMBER        NOT NULL,
    SUPPLIER_ID       NUMBER,
    PRODUCT_ID        NUMBER,
    REQ_QUANTITY      NUMBER,
    QUTE_QUANTITY     NUMBER,
    QUOTATION_PRICE   NUMBER(10,2),
    DELIVERY_DATE     DATE,
    STATUS            VARCHAR2(20),
    REMARKS           VARCHAR2(255),
    PRODUCT_NAME      VARCHAR2(100),
    SUPPLIER_NAME     VARCHAR2(100),
    APPROVE_STATUS    VARCHAR2(20),
    APPROVED          NUMBER,
    CREATE_DATE       DATE DEFAULT SYSDATE
);


ALTER TABLE QUOTATION_MASTER
ADD CONSTRAINT FK_QUOT_REQ
FOREIGN KEY (REQ_ID)
REFERENCES REQ_MASTER (REQUISITION_ID);


-- 1. QUOT_MASTER_ID -> QUOTATION_MASTER
ALTER TABLE QUOTATION_DETAILS
ADD CONSTRAINT FK_QUOT_DET_MASTER
FOREIGN KEY (QUOT_MASTER_ID)
REFERENCES QUOTATION_MASTER (QUOT_MASTER_ID);

-- 2. PRODUCT_ID -> PRODUCTS
ALTER TABLE QUOTATION_DETAILS
ADD CONSTRAINT FK_QUOT_DET_PRODUCT
FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCTS (PRODUCT_ID);

-- 3. SUPPLIER_ID -> SUPPLIERS
ALTER TABLE QUOTATION_DETAILS
ADD CONSTRAINT FK_QUOT_DET_SUPPLIER
FOREIGN KEY (SUPPLIER_ID)
REFERENCES SUPPLIERS (SUPPLIER_ID);


CREATE TABLE PURCHASE_MASTER (
    PURCHASE_ID           NUMBER        PRIMARY KEY,
    QUOT_MASTER_ID        NUMBER,
    PURCHASE_DATE         DATE          DEFAULT SYSDATE,
    TOTAL_AMOUNT          NUMBER(10,2),
    CREATED_BY            VARCHAR2(50),
    APPROVED_BY           VARCHAR2(50),
    APPROVAL_STATUS       VARCHAR2(20),
    PAYMENT_STATUS        VARCHAR2(20),
    REMARKS               VARCHAR2(255),
    CREATED_DATE          DATE          DEFAULT SYSDATE,
    MODIFIED_DATE         DATE          DEFAULT SYSDATE,
    QUATATION_APPROVE_ID  NUMBER,
    SUPPLIER_NAME         VARCHAR2(100),
    NET_TOTAL_AMOUNT      NUMBER(10,2),
    PERCENTAGE            NUMBER(5,2),
    VAT                   NUMBER(10,2),
    BILL_AMOUNT           NUMBER(10,2),
    GIVEN_AMOUNT          NUMBER(10,2),
    DUE_AMOUNT            NUMBER(10,2),
    NET_AMOUNT            NUMBER(10,2),
    SUPPLIER_ID           NUMBER,
    PURCHASE_DONE         NUMBER,
    GIVEN_DUE_AMOUNT      NUMBER(15,2)
);


CREATE TABLE PURCHASE_DETAILS (
    PURCHASE_DETAIL_ID   NUMBER       PRIMARY KEY,
    PURCHASE_ID          NUMBER,
    TOTAL_PRICE          NUMBER(10,2),
    REMARKS              VARCHAR2(255),
    CREATED_DATE         DATE         DEFAULT SYSDATE,
    QUTE_QUANTITY        NUMBER,
    QUATATION_PRICE      NUMBER(10,2),
    PRODUCT_ID           NUMBER,
    PRODUCT_NAME         VARCHAR2(100),
    VAT                  NUMBER(10,2),
    BILL_AMOUNT          NUMBER(10,2),
    GIVEN_AMOUNT         NUMBER(10,2),
    DUE_AMOUNT           NUMBER(10,2),
    VAT_PERCENTAGE       NUMBER(5,2),
    NET                  NUMBER(10,2),
    SUPPLIER_NAME        VARCHAR2(100),
    SUPPLIER_ID          NUMBER,
    DISCOUNT_AMOUNT      NUMBER,
    GIVEN_DUE_AMOUNT     NUMBER(15,2)
);


-- PURCHASE_DETAILS -> PURCHASE_MASTER
ALTER TABLE PURCHASE_DETAILS
ADD CONSTRAINT FK_PURCHASE_DET_MASTER
FOREIGN KEY (PURCHASE_ID)
REFERENCES PURCHASE_MASTER (PURCHASE_ID);

-- PURCHASE_DETAILS -> PRODUCTS
ALTER TABLE PURCHASE_DETAILS
ADD CONSTRAINT FK_PURCHASE_DET_PRODUCT
FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCTS (PRODUCT_ID);

-- PURCHASE_DETAILS -> SUPPLIERS
ALTER TABLE PURCHASE_DETAILS
ADD CONSTRAINT FK_PURCHASE_DET_SUPPLIER
FOREIGN KEY (SUPPLIER_ID)
REFERENCES SUPPLIERS (SUPPLIER_ID);

-- PURCHASE_MASTER -> QUOTATION_MASTER (optional, if exists)
ALTER TABLE PURCHASE_MASTER
ADD CONSTRAINT FK_PURCHASE_MASTER_QUOT
FOREIGN KEY (QUOT_MASTER_ID)
REFERENCES QUOTATION_MASTER (QUOT_MASTER_ID);

-- PURCHASE_MASTER -> QUOTATION_MASTER approval ID (optional)
ALTER TABLE PURCHASE_MASTER
ADD CONSTRAINT FK_PURCHASE_MASTER_QUOT_APPROVE
FOREIGN KEY (QUATATION_APPROVE_ID)
REFERENCES QUOTATION_MASTER (QUOT_MASTER_ID);

-- PURCHASE_MASTER -> SUPPLIERS
ALTER TABLE PURCHASE_MASTER
ADD CONSTRAINT FK_PURCHASE_MASTER_SUPPLIER
FOREIGN KEY (SUPPLIER_ID)
REFERENCES SUPPLIERS (SUPPLIER_ID);
---------------------------------------------------
--create view for schema
---------------------------------------------------
--view to get requisition details

DROP VIEW SCMDB.VIEW_REQUISITION_DETAILS;

/* Formatted on 19/12/2025 00:04:45 (QP5 v5.256.13226.35538) */
CREATE OR REPLACE FORCE VIEW SCMDB.VIEW_REQUISITION_DETAILS
(
   REQUISITION_ID,
   REQUISITION_DATE,
   QUOT_STATUS,
   REQ_DETAIL_ID,
   PRODUCT_ID,
   PRODUCT_NAME,
   QTY_REQUESTED,
   PURCHASE_PRICE,
   SELL_PRICE
)
   BEQUEATH DEFINER
AS
   SELECT rm.REQUISITION_ID,
          rm.REQUISITION_DATE,
          rm.QUOT_STATUS,
          rd.REQ_DETAIL_ID,
          rd.PRODUCT_ID,
          rd.PRODUCT_NAME,
          rd.QTY_REQUESTED,
          rd.PURCHASE_PRICE,
          rd.SELL_PRICE
     FROM REQ_MASTER rm
          JOIN REQ_DETAILS rd ON rm.REQUISITION_ID = rd.REQUISITION_ID;



DROP VIEW SCMDB.VW_QUOTATION_SUMMARY;

-----------------------------------------------------------
-- View for Quotation Summary

/* Formatted on 19/12/2025 00:03:28 (QP5 v5.256.13226.35538) */
CREATE OR REPLACE FORCE VIEW SCMDB.VW_QUOTATION_SUMMARY
(
   QUOT_MASTER_ID,
   REQ_ID,
   QUOT_DATE,
   QUOT_DET_ID,
   SUPPLIER_ID,
   PRODUCT_ID,
   REQ_QUANTITY,
   QUTE_QUANTITY,
   QUOTATION_PRICE,
   DELIVERY_DATE
)
   BEQUEATH DEFINER
AS
   SELECT qm.QUOT_MASTER_ID,
          qm.REQ_ID,
          qm.QUOT_DATE,
          qd.QUOT_DET_ID,
          qd.SUPPLIER_ID,
          qd.PRODUCT_ID,
          qd.REQ_QUANTITY,
          qd.QUTE_QUANTITY,
          qd.QUOTATION_PRICE,
          qd.DELIVERY_DATE
     FROM QUOTATION_MASTER qm
          JOIN QUOTATION_DETAILS qd ON qm.QUOT_MASTER_ID = qd.QUOT_MASTER_ID;

DROP VIEW SCMDB.VW_PURCHASE_INFO2;

/* Formatted on 19/12/2025 00:04:23 (QP5 v5.256.13226.35538) */
CREATE OR REPLACE FORCE VIEW SCMDB.VW_PURCHASE_INFO2
(
   MASTER_PURCHASE_ID,
   QUOT_MASTER_ID,
   PURCHASE_DATE,
   MASTER_TOTAL_AMOUNT,
   MASTER_NET_TOTAL_AMOUNT,
   MASTER_GIVEN_AMOUNT,
   MASTER_DUE_AMOUNT,
   MASTER_GIVEN_DUE_AMOUNT,
   PURCHASE_DETAIL_ID,
   DETAIL_PRODUCT_ID,
   DETAIL_PRODUCT_NAME,
   DETAIL_SUPPLIER_ID,
   DETAIL_SUPPLIER_NAME,
   DETAIL_TOTAL_PRICE,
   DETAIL_DISCOUNT_AMOUNT,
   VAT_PERCENTAGE,
   DETAIL_VAT_AMOUNT,
   DETAIL_NET_AMOUNT,
   DETAIL_GIVEN_AMOUNT,
   DETAIL_DUE_AMOUNT,
   DETAIL_GIVEN_DUE_AMOUNT
)
   BEQUEATH DEFINER
AS
   SELECT pm.PURCHASE_ID AS MASTER_PURCHASE_ID,
          pm.QUOT_MASTER_ID,
          pm.PURCHASE_DATE,
          pm.TOTAL_AMOUNT AS MASTER_TOTAL_AMOUNT,
          pm.NET_TOTAL_AMOUNT AS MASTER_NET_TOTAL_AMOUNT,
          pm.GIVEN_AMOUNT AS MASTER_GIVEN_AMOUNT,
          pm.DUE_AMOUNT AS MASTER_DUE_AMOUNT,
          pm.GIVEN_DUE_AMOUNT AS MASTER_GIVEN_DUE_AMOUNT,
          pd.PURCHASE_DETAIL_ID,
          pd.PRODUCT_ID AS DETAIL_PRODUCT_ID,
          pd.PRODUCT_NAME AS DETAIL_PRODUCT_NAME,
          pd.SUPPLIER_ID AS DETAIL_SUPPLIER_ID,
          pd.SUPPLIER_NAME AS DETAIL_SUPPLIER_NAME,
          pd.TOTAL_PRICE AS DETAIL_TOTAL_PRICE,
          pd.DISCOUNT_AMOUNT AS DETAIL_DISCOUNT_AMOUNT,
          pd.VAT_PERCENTAGE,
          pd.VAT AS DETAIL_VAT_AMOUNT,
          pd.NET AS DETAIL_NET_AMOUNT,
          pd.GIVEN_AMOUNT AS DETAIL_GIVEN_AMOUNT,
          pd.DUE_AMOUNT AS DETAIL_DUE_AMOUNT,
          pd.GIVEN_DUE_AMOUNT AS DETAIL_GIVEN_DUE_AMOUNT
     FROM SCMDB.PURCHASE_MASTER pm
          JOIN SCMDB.PURCHASE_DETAILS pd ON pm.PURCHASE_ID = pd.PURCHASE_ID
    WHERE NVL (pm.DUE_AMOUNT, 0) > 0 AND NVL (pd.DUE_AMOUNT, 0) > 0;


--trigger for update purchase_details and purchase_master

CREATE OR REPLACE TRIGGER SCMDB.TR_VW_PURCHASE_INFO2_IU
INSTEAD OF UPDATE ON SCMDB.VW_PURCHASE_INFO2
FOR EACH ROW
BEGIN
    -- 1. Update the Header Table (PURCHASE_MASTER)
    -- This handles Master-level updates, including the new MASTER_GIVEN_DUE_AMOUNT.
    -- We assume the base table column is also named GIVEN_DUE_AMOUNT.
    UPDATE SCMDB.PURCHASE_MASTER PM
    SET 
        PM.GIVEN_AMOUNT = :NEW.MASTER_GIVEN_AMOUNT,
        PM.DUE_AMOUNT = :NEW.MASTER_DUE_AMOUNT,      
        
        -- *** NEW COLUMN ADDED HERE ***
        PM.GIVEN_DUE_AMOUNT = :NEW.MASTER_GIVEN_DUE_AMOUNT, 
        
        PM.QUOT_MASTER_ID = :NEW.QUOT_MASTER_ID,
        PM.MODIFIED_DATE = SYSDATE,
        
        -- Including the redundant supplier name column to prevent ORA-01779 
        -- if the Forms application updates it.
        PM.SUPPLIER_NAME = :NEW.DETAIL_SUPPLIER_NAME
    WHERE PM.PURCHASE_ID = :OLD.MASTER_PURCHASE_ID;
    
    
    -- 2. Update the Detail Table (PURCHASE_DETAILS)
    -- This handles Detail-level updates.
    UPDATE SCMDB.PURCHASE_DETAILS PD
    SET 
        PD.GIVEN_AMOUNT = :NEW.DETAIL_GIVEN_AMOUNT,
        PD.DUE_AMOUNT = :NEW.DETAIL_DUE_AMOUNT,      
        
        -- Detail GIVEN_DUE_AMOUNT
        PD.GIVEN_DUE_AMOUNT = :NEW.DETAIL_GIVEN_DUE_AMOUNT, 
        
        -- Other mandatory detail line fields for a successful Forms update


        PD.VAT_PERCENTAGE = :NEW.VAT_PERCENTAGE,
        
        -- Include detail supplier name if it can be updated on this form
        PD.SUPPLIER_NAME = :NEW.DETAIL_SUPPLIER_NAME
    WHERE PD.PURCHASE_DETAIL_ID = :OLD.PURCHASE_DETAIL_ID;
    
END;
/

CREATE TABLE SELL_ORDER_MASTER (
    SELL_ORDER_ID        NUMBER        NOT NULL PRIMARY KEY,
    CUSTOMER_ID          NUMBER,
    SALE_DATE            DATE          DEFAULT SYSDATE,
    CUST_PHONE           VARCHAR2(15),
    TOTAL_AMOUNT         NUMBER(10,2),
    PAID_AMOUNT          NUMBER(10,2),
    DUE_AMOUNT           NUMBER(10,2),
    DISCOUNT_PERCENTAGE  NUMBER(5,2),
    DISCOUNT_AMOUNT      NUMBER(10,2),
    NET_PAYABLE_AMO      NUMBER(10,2),
    INVOICE_NO           VARCHAR2(50),
    PAYMENT_METHOD       VARCHAR2(30),
    PAYMENT_STATUS       VARCHAR2(20),
    DELIVERY_STATUS      VARCHAR2(20),
    SALES_REP_ID         NUMBER,
    NOTES                VARCHAR2(300),
    CREATED_BY           VARCHAR2(50),
    CREATED_DATE         DATE          DEFAULT SYSDATE,
    UPDATED_BY           VARCHAR2(50),
    UPDATED_DATE         DATE          DEFAULT SYSDATE
);

CREATE TABLE SELL_ORDER_DETAILS (
    SELL_ORDER_DETAIL_ID   NUMBER        NOT NULL PRIMARY KEY,
    SELL_ORDER_ID          NUMBER,
    PRODUCT_ID             NUMBER,
    PRODUCT_NAME           VARCHAR2(100),
    UNIT_TYPE              VARCHAR2(10),
    PRICE                  NUMBER(10,2),
    QUANTITY               NUMBER,
    TOTAL_AMOUNT           NUMBER(10,2),
    DISCOUNT_PERCENT       NUMBER(5,2),
    DISCOUNT_AMOUNT        NUMBER(10,2),
    TAX_PERCENT            NUMBER(5,2),
    TAX_AMOUNT              NUMBER(10,2),
    WAREHOUSE_NAME         VARCHAR2(100),
    SERIAL_NUMBER          VARCHAR2(100),
    NOTES                  VARCHAR2(200),
    CREATED_BY             VARCHAR2(50),
    CREATED_DATE           DATE          DEFAULT SYSDATE,
    AVAILABLE_STOCK_QTY    NUMBER
);

ALTER TABLE SELL_ORDER_DETAILS
ADD CONSTRAINT FK_SOD_SO_MASTER
FOREIGN KEY (SELL_ORDER_ID)
REFERENCES SELL_ORDER_MASTER (SELL_ORDER_ID);

ALTER TABLE SELL_ORDER_DETAILS
ADD CONSTRAINT FK_SOD_PRODUCTS
FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCTS (PRODUCT_ID);

ALTER TABLE SELL_ORDER_MASTER
ADD CONSTRAINT FK_SOM_CUSTOMER
FOREIGN KEY (CUSTOMER_ID)
REFERENCES CUSTOMER (CUSTOMER_ID);


CREATE TABLE STOCK_VIEW (
    PRODUCT_ID      NUMBER        NOT NULL PRIMARY KEY,
    PRODUCT_NAME    VARCHAR2(150),
    CATEGORY_ID     NUMBER,
    CATEGORY_NAME   VARCHAR2(100),
    BRAND_ID        NUMBER,
    BRAND_NAME      VARCHAR2(100),
    TYPE_ID         NUMBER,
    TYPE_NAME       VARCHAR2(100),
    STOCK_QTY       NUMBER
);


ALTER TABLE STOCK_VIEW
ADD CONSTRAINT FK_SV_TYPE
FOREIGN KEY (TYPE_ID)
REFERENCES PRODUCT_TYPES (TYPE_ID);
