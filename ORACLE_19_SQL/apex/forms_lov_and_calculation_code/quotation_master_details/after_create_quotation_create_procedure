CREATE OR REPLACE PROCEDURE SCMDB.insert_data_intoQute_approve (
    P_QUOT_MASTER_ID IN NUMBER
)
IS
    CURSOR c IS
        SELECT
            QUOT_DET_ID,
            QUOT_MASTER_ID,
            SUPPLIER_ID,
            PRODUCT_ID,
            REQ_QUANTITY,
            QUTE_QUANTITY,
            QUOTATION_PRICE,
            DELIVERY_DATE,
            STATUS,
            REMARKS,
            PRODUCT_NAME,
            SUPPLIER_NAME
        FROM
            QUOTATION_DETAILS
        WHERE
            QUOT_MASTER_ID = P_QUOT_MASTER_ID;

    v_QUOT_APPROVE_ID NUMBER;
BEGIN
    FOR rec IN c LOOP
        -- If you have a sequence, use this (recommended):
        -- SELECT QUOT_APPROVE_SEQ.NEXTVAL INTO v_QUOT_APPROVE_ID FROM dual;

        -- Otherwise, fallback to MAX + 1
        SELECT NVL(MAX(QUOT_APPROVE_ID), 0) + 1
        INTO v_QUOT_APPROVE_ID
        FROM QUOTATION_APPROVE;

        INSERT INTO QUOTATION_APPROVE (
            QUOT_APPROVE_ID,
            QUOT_DET_ID,
            QUOT_MASTER_ID,
            SUPPLIER_ID,
            PRODUCT_ID,
            REQ_QUANTITY,
            QUTE_QUANTITY,
            QUOTATION_PRICE,
            DELIVERY_DATE,
            STATUS,
            REMARKS,
            PRODUCT_NAME,
            SUPPLIER_NAME,
            APPROVE_STATUS
        )
        VALUES (
            v_QUOT_APPROVE_ID,
            rec.QUOT_DET_ID,
            rec.QUOT_MASTER_ID,
            rec.SUPPLIER_ID,
            rec.PRODUCT_ID,
            rec.REQ_QUANTITY,
            rec.QUTE_QUANTITY,
            rec.QUOTATION_PRICE,
            rec.DELIVERY_DATE,
            rec.STATUS,
            rec.REMARKS,
            rec.PRODUCT_NAME,
            rec.SUPPLIER_NAME,
            'PENDING'
        );
    END LOOP;

    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
        ROLLBACK;
END;
/
